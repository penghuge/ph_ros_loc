# 反光板定位

1. 激光数据、反光柱提取

   - 订阅话题/scan进行处理回调 `AddLaserScanMessage`()
   - 激光强点过滤 `CalculateReflectorPoint`()
   - 按照反光柱反光强度衰减曲线提取激光高强度反光点 `FilterReflectorScan`()
   - 将高强度反光激光数据点分裂成不同的束 `SplitReflector`()即确定为不同反光柱
   - 根据反光柱半径和扫射到反光柱的激光点的坐标位置拟合计算出反光柱中心点坐标，将坐标数据加入到反光柱位置点集合队列 `ExtractReflectorPoint`()
2. 反光柱静态定位

   - 从激光帧数据过滤器中反光柱位置点集合队列提取最新反光柱数据 `GetRflectorPoints`()
   - 将最新反光柱数据送入 `ReflectorLocation`处理 `SetScanReflectorPoints`()
   - 将反光柱数据与反光柱地图中数据进行匹配 `MatchReflector ()`
   - 将反光柱数据按照拉普拉斯展开余子式提取出多组数据组合 `PointSet::choose`()
   - 将每一组扫描的反光柱数据与反光柱地图中数据按照点与点之间边长进行匹配 `ReflectorLocation::Match()`
   - 在匹配过程中，首先将反光柱坐标点和已有反光柱地图坐标点分别生成图矩阵其表格数据为两点间距离，在反光柱地图坐标图矩阵中查找与扫描的反光柱坐标点边长匹配的点成对放入候选点集合 `ReflectorLocation::GetCandidateWithEdge`()
   - 将候选点与地图中点进行匹配，找到对应的反光柱坐标点集合 `ReflectorLocation::AppendCandidates`()
   - 最小二乘法求解出最优位姿 `ReflectorLocation::CalcPose`()
   - 将求解的位姿放入位姿列表，如果无法求解，则减少扫描点数量重新执行匹配计算，若求解结果唯一则为最优正解，若不唯一，则意味着存在有距离相近的误匹配的反光柱干扰
3. 反光柱动态定位

   - 根据AGV运动的线速度与角速度预测其位姿 `predict_pose`
   - 将扫描到的反光柱坐标点进行动态匹配 `ReflectorLocation::DynamicMatch`()
   - 在动态匹配过程中，首先将扫描的反光板位置根据当前预测 `predict_pose`转换为地图中的世界坐标
   - 在反光柱地图中遍历查找与扫描到的反光柱相匹配的地图反光柱
   - 将互相匹配的反光柱在ekf中依次进行更新，迭代计算出最优的位姿
